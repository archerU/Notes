# 图片预加载

提前请求加载图片到本地，后面需要就可以直接从缓存中换取。

## 预加载原理

new Image()，然后使用onload方法回调预加载完成事件，当浏览器把图片下载到本地后，之后同样的src就直接使用缓存。

## 进度条问题

由于预加载的同时，还得做一个预加载的效果，这就需要把加载的进度实时通知到外部上下文才行。
关于进度有两个实现方式：

- 第一是已加载的数据大小/总的数据大小
- 第二是已加载的文件数/总的文件数

在浏览器里面，采用第一种方式是不现实的，根本没有原生的办法可以做到，所以只能采用第二种。

## 图片加载失败问题

比如说有4张图片，已经加载了50%，在加载第三张的时候出错了，该不该将进度反馈成75%呢？答案是：应该。如果不这么处理的话，进度永远无法到100%，页面主内容就没机会显示了，虽然图片加载有失败的情况，但是跟加载器没有关系，也许图片本身就不存在呢？也就是说图片加载失败不应该影响加载器的功能。

## 图片加载超时问题

图片不能加载太久，否则用户一直停留在加载效果上看不到主内容，用户的等待时间不可控制地延长，导致用户体验下降，这样就有悖加载器的初衷了。所以应该给每个图片设置一个加载的超时时间，如果在所有图片的超时时间之后，还没加载完，就应该主动放弃加载，通知外部上下文加载完毕，显示主内容。

## 代码

```
const img = new Image();
img.src = 'xxx';
```

## 何时使用

- 一般页面大小超过3M
- 页面内包含数据量比较大的图片，在手机端测试能够明显看到加载缓慢的时候


